<!DOCTYPE html>
<html>
  <head>
    <title>Capacity and Scaling</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link rel="stylesheet" type="text/css" href="lib/default.css"/>
  </head>
  <body>
    <textarea id="source">

name: center
layout: true
class: center, middle
.footer[![:scale 5em](design-assets/Basho-Logos/svg/basho-logo-color-horiz.svg) &copy; Basho Technologies 2015]

---

name: standard
layout: true
class: left, top
.footer[![:scale 5em](design-assets/Basho-Logos/svg/basho-logo-color-horiz.svg) &copy; Basho Technologies 2015]

---
template: center

# Capacity & Scaling

---

# Considerations

* RAM
* Disk space
* Disk IO
* Read/Write Profile
* Number of nodes and ring size
* Network IO

???
RAM most important - crucial for bitcask - leveldb if this is an issue Disk - Disk space needs are much easier to calculate and essentially boil down to a simple equation Disk IO - no need for RAID? discussion Read/Write profile  - mainly writes? less RAM  - reading only new keys? less RAM Network - riak is chatty, put it on a low latency fast network. gigabit or more

---

# Capacity Planning

* Initial Capacity
* Scaling Profile
* Scaling Thresholds

---

# Initial Capacity

* How many objects?
* What size are the objects?
* Object count change over time?

---

# Access Profile

* How many requests per second?
* What is the request distribution?

---

# Bottlenecks

![:scale 100%](./107-capacity-and-scaling/bottlenecks.png)

---

# Estimating Disk Capacity

* Disk space per node

`(objects * size) * (n_val / node count)`

--

`(60,000,000 * 10kB) * (3 replicas / 5 nodes)` = 360GB per node

---

# `ring_creation_size`

* Can only be set once (2.x can be increased)
* Power of 2
* All nodes must agree
* 10-30 vnodes per node is considered best

???
128 is good for 5-10 nodes 256 is a good number for scaling between 5 and 20 nodes consider overhead of vnode processes and backends

---

# Thresholds

* CPU: 75% x num_cores
* Memory: 75% utilization
* Swap: >0% used
* File Descriptors: 75% of ulimit

---

# Tips

* Bitcask calculator
* Scale early to avoid handoff pain
* Scale up in groups not a node at a time
* Up transfer limit off-peak (if you have one)
* Auto scale up but not down
* Configuration management avoids human error

    </textarea>
    <script src="lib/remark.js" type="text/javascript">
    </script>
	<script type="text/javascript">
        remark.macros.scale = function (percentage) {
          var url = this;
          return '<img src="' + url + '" style="width: ' + percentage + '" />';
          // Usage:
          //   ![:scale 50%](image.jpg)
          // Outputs:
          //   <img src="image.jpg" style="width: 50%" />
    };
	</script>
    <script type="text/javascript">
      var slideshow = remark.create();
    </script>
  </body>
</html>
